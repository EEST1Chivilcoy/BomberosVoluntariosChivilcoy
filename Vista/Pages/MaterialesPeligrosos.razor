@inject NavigationManager navigationManager
@inject IDbContextFactory<BomberosDbContext> DbFactory
@page "/salidas/materiales-peligrosos"
@using System.ComponentModel.DataAnnotations;
@using System.Text.Json;
@using Vista.Data.ViewModels.MaterialesPeligrosos;
@using Vista.Data.ViewModels.Personal;

<Form  Model="@modelMateriales"
      LabelColSpan="8"
      WrapperColSpan="16"
      OnFinish="OnFinish"
      OnFinishFailed="OnFinishFailed">
    @*Datos generales de las salidas*@
    <FormItem Label="Numero de parte">
        <AntDesign.InputNumber @bind-Value="modelMateriales.NumeroParte" />
    </FormItem>
    <FormItem Label="Dato Hora salida">
        <DatePicker TValue="DateTime" ShowTime="@true" OnChange="OnChange" @bind-Value="@modelMateriales.HoraSalida" />
    </FormItem>
    <FormItem Label="Dato Hora llegada">
        <DatePicker TValue="DateTime" ShowTime="@true" OnChange="OnChange" @bind-Value="@modelMateriales.HoraLLegada" />
    </FormItem>
    <FormItem Label="Kilometor llegada">
        <AntDesign.InputNumber  @bind-Value="modelMateriales.KmSalida" />
    </FormItem>
    <FormItem Label="Kilometor llegada">
        <AntDesign.InputNumber @bind-Value="modelMateriales.KmLlegada" />
    </FormItem>
    <FormItem Label="Calle/Ruta">
        <Input @bind-Value="@modelMateriales.CalleORuta" />
    </FormItem>
    <FormItem Label="Numero/kilometro">
        <Input @bind-Value="@modelMateriales.NumeroOKilometro" />
    </FormItem>
    <FormItem Label="Entre calles">
        <Input @bind-Value="@modelMateriales.EntreCalles" />
    </FormItem>
    <FormItem Label="PisoNumero">
        <Input @bind-Value="@modelMateriales.PisoNumero" />
    </FormItem>
    <FormItem Label="Depto">
        <Input @bind-Value="@modelMateriales.Depto" />
    </FormItem>
    <FormItem Label="Tipo zona">
        <EnumSelect TEnum="TipoZona" @bind-Value="@modelMateriales.TipoZona" />
    </FormItem>
    @*Solicitante datos*@
    <b><label>Datos de solicitante</label></b>
    <FormItem Label="Nombre del solicitante">
        <Input @bind-Value="@modelMateriales.NombreSolicitante" />
    </FormItem>
    <FormItem Label="Apelldio del solicitante">
         <Input @bind-Value="@modelMateriales.ApellidoSolicitante" />
    </FormItem>
    <FormItem Label="documneto del solicitante">
         <Input @bind-Value="@modelMateriales.DniSolicitante" />
    </FormItem>
    <FormItem Label="Telefono  del solicitante">
         <Input @bind-Value="@modelMateriales.TelefonoSolicitante" />
    </FormItem>
    @*Datos bomberos receptor*@
    <FormItem Label="Nombre del receptor">
        <Input @bind-Value="@modelMateriales.NombreReceptor" />
    </FormItem>
    <FormItem Label="apellido del recepetor">
        <Input @bind-Value="@modelMateriales.ApellidoReceptor" />
    </FormItem>
    <FormItem Label="Numero legajo">
        <AntDesign.InputNumber @bind-Value="modelMateriales.LegajoReceptor" />
    </FormItem>

    @*Datos de damnificados*@
    <FormItem Label="¿Ubo damnificados?">
        <Switch @bind-Checked="switchValue" />
    </FormItem>
    @if (switchValue == true)
    {
        <FormItem Label="Nombre">
            <Input @bind-Value="@damnificado.Nombre" />
        </FormItem>
         <FormItem Label="Apellido">
            <Input @bind-Value="@damnificado.Apellido" />
        </FormItem>
        <FormItem Label="Documento">
            <Input @bind-Value="@damnificado.Dni" />
        </FormItem>
        <FormItem Label="Tipo material">
            <EnumSelect TEnum="TipoSexo" @bind-Value="@damnificado.Sexo" />
        </FormItem>
        <FormItem Label="Lugar De nacimiento">
            <Input @bind-Value="@damnificado.LugarDeNacimiento" />
        </FormItem>
        <FormItem Label="edad">
            <AntDesign.InputNumber @bind-Value="damnificado.Edad" />
        </FormItem>
        <FormItem Label="Tipo material">
            <EnumSelect TEnum="TipoDamnificado" @bind-Value="@damnificado.Estado" />
        </FormItem>
    }
    @*Datos de Vehiculos  damnificados*@
    <FormItem Label="¿Ubo vehiculos damnificados?">
        <Switch @bind-Checked="switchValuev" />
    </FormItem>
    @if (switchValuev == true )
    {
        <FormItem Label="Color">
            <Input @bind-Value="@damnificado.Color" />
        </FormItem>
        <Checkbox @bind-Checked="chek"> Airbag</Checkbox>
        
    }
    @*Datos Del seguro*@
    <FormItem Label="Compania Aseguradora">
        <Input @bind-Value="@modelMateriales.CompaniaAseguradora" />
    </FormItem>
    <FormItem Label="NumeroPoliza">
        <Input @bind-Value="@modelMateriales.NumeroPoliza" />
    </FormItem>
    <FormItem Label="FechaVencimineto">
        <DatePicker TValue="DateTime" ShowTime="@true" OnChange="OnChange" @bind-Value="@modelMateriales.FechaVencimineto" />
    </FormItem>
    @*Moviles de salidas*@
    @*a la hora de pedir el chofer y movil, 
    pedir dato unico para no cargar todo y buscarlo en la base de datos*@
    <b><label>Datos de chofer</label></b>
    <br />
     <Checkbox @bind-Checked="chekM"> Cargo combustible</Checkbox>
    <FormItem Label="Numero de legajo">
        <Input @bind-Value="movilSalidaViewModels.NumeroLegajo" />
    </FormItem>
    <FormItem Label="Numero de movil">
        <Input @bind-Value="movilSalidaViewModels.NumeroMovil" />
    </FormItem>
    <br />
    <Button>Cargar Movil salida</Button>
    @*Cuerpos paraticipantes*@
    <b><label>Cuerpo Participante</label></b>
    <FormItem Label="Tipo Escalafon">
        <EnumSelect TEnum="EscalafonJerarquico" @bind-Value="@bomberoSalidaView.Grado" />
    </FormItem>
    <FormItem Label="Numero de legajo">
        <AntDesign.InputNumber @bind-Value="bomberoSalidaView.NumeroLegajo" />
    </FormItem>
    <FormItem Label="Nombre de bombero">
        <Input @bind-Value="bomberoSalidaView.Nombre" />
    </FormItem>
    <FormItem Label="Apellido de bombero">
        <Input @bind-Value="bomberoSalidaView.Apellido" />
    </FormItem>
    <Checkbox @bind-Checked="chekB"> Salio</Checkbox>
    <br />
    <Button>Cargar cuerpo participante</Button>
    <br />
    <b><label>Datos encargados</label></b>
    <FormItem Label="Nombre del bombero">
        <Input @bind-Value="modelMateriales.NombreEncargado" />
    </FormItem>
    <FormItem Label="Apellido del bombero">
        <Input @bind-Value="modelMateriales.ApellidoEncargado" />
    </FormItem>
    <FormItem Label="Numero de legajo">
        <AntDesign.InputNumber @bind-Value="modelMateriales.LegajoEncargado" />
    </FormItem>
    <b><label>Quien lleno planilla</label></b>
    <FormItem Label="Nombre del bombero">
        <Input @bind-Value="modelMateriales.NombreLLenoPlanilla" />
    </FormItem>
    <FormItem Label="Apellido del bombero">
        <Input @bind-Value="modelMateriales.ApllidoLLenoPlanilla" />
    </FormItem>
    <FormItem Label="Numero de legajo">
        <AntDesign.InputNumber @bind-Value="modelMateriales.LegajoLLenoPlanilla" />
    </FormItem>

    @*Tipo servicio*@
    <FormItem Label="Tipo Servicio salida">
        <EnumSelect TEnum="TipoServicioSalida" @bind-Value="@modelMateriales.TipoServicio" />
    </FormItem>

   @*propio de la salida de tipo material*@
    <FormItem Label="Tipo material">
        <EnumSelect TEnum="TipoMaterialPeligroso" @bind-Value="@modelMateriales.Tipo" />
    </FormItem>
    <b><label>Acciones sobre los materiales</label></b>
    <Checkbox Indeterminate="@indeterminate" Checked="@checkAll" CheckedChange="@CheckAllChanged">
     Check all
    </Checkbox>
    <br />
    <AntDesign.CheckboxGroup Options="@ckeckAllOptions" ValueChanged="@OnChanged" />
    
    <FormItem Label="Detalles Acciones ">
        <Input @bind-Value="modelMateriales.DetallesAccionesMateriales" />
    </FormItem>
    @*Acciones sobre personas*@
    <FormItem Label="Tipo Evacuacion">
        <EnumSelect TEnum="TipoEvacuacion" @bind-Value="@modelMateriales.Evacuacion" />
    </FormItem>
    <br />
    <b><label>Acciones sobre personas</label></b>
    <AntDesign.CheckboxGroup Options="@ckeckAllOptionsP" ValueChanged="@OnChanged" />
    <FormItem Label="Detalles Acciones Personas ">
        <Input @bind-Value="modelMateriales.DetallesAccionesPersonas" />
    </FormItem>
    <FormItem Label="Tipo Superficie">
        <EnumSelect TEnum="TipoSuperficie" @bind-Value="@modelMateriales.TipoSuperficie" />
    </FormItem>
    <FormItem Label="Detalles Surpeficie Afectada ">
        <Input @bind-Value="modelMateriales.DetalleSuperficieAfectada" />
    </FormItem>
    <FormItem Label="Tipo Evacuacion">
        <EnumSelect TEnum="TipoSituacionExplosion" @bind-Value="@modelMateriales.TipoSituacion" />
    </FormItem>


    <FormItem WrapperColOffset="8" WrapperColSpan="16">
        <Button Type="@ButtonType.Primary" HtmlType="submit">
            Cargar salida
        </Button>
    </FormItem>
</Form>

@code
{

    private DamnificadoViewModels damnificado = new();
    private MaterialPeligrosoViewModels modelMateriales = new ();
    private MovilSalidaViewModels movilSalidaViewModels = new();
    private BomberoSalidaViewModels bomberoSalidaView = new();

    bool switchValue { get; set; }
    bool switchValuev { get; set; }
    bool chek { get; set; }
    bool chekM { get; set; }
    bool chekB { get; set; }
    private void OnFinish(EditContext editContext)
    {
        Console.WriteLine($"Success:{JsonSerializer.Serialize(modelMateriales)}");
    }

    private void OnFinishFailed(EditContext editContext)
    {
        Console.WriteLine($"Failed:{JsonSerializer.Serialize(modelMateriales)}");
    }
    private void OnChange(DateTimeChangedEventArgs args)
    {
        Console.WriteLine($"Selected Time: {args.Date}");
        Console.WriteLine($"Formatted Selected Time: {args.DateString}");
    }
    // array de las opciones posibles, buscar la opcion y agregarla en la planilla
    static CheckboxOption[] ckeckAllOptions = new CheckboxOption[]{
        new CheckboxOption{ Label="Controlada",Value="Controlada" },
        new CheckboxOption{ Label="Venteo", Value="Venteo" },
        new CheckboxOption{ Label="DilucionDeVapores", Value="DilucionDeVapores"},
        new CheckboxOption{ Label="Neutralizacion",Value="Neutralizacion" },
        new CheckboxOption{ Label="Trasvase",Value="Trasvase" },
        new CheckboxOption{ Label="Otro",Value="Otro" },
    };
    static CheckboxOption[] ckeckAllOptionsP = new CheckboxOption[]{
        new CheckboxOption{ Label="Descontaminacion",Value="Descontaminacion" },
        new CheckboxOption{ Label="Confinamiento", Value="Confinamiento" },
        new CheckboxOption{ Label="SinAccion", Value="SinAccion"},
        new CheckboxOption{ Label="Otro",Value="Otro" },
    };
    void CheckAllChanged()
    {
        bool allChecked = checkAll;
        ckeckAllOptions.ForEach(o => o.Checked = !allChecked);
    }

    void OnChanged()
    {

    }

    bool indeterminate => ckeckAllOptions.Count(o => o.Checked) > 0 && ckeckAllOptions.Count(o => o.Checked) < ckeckAllOptions.Count();

    bool checkAll => ckeckAllOptions.All(o => o.Checked);

}

    


