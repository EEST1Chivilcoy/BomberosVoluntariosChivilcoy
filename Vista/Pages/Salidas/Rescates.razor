@inject IMessageService message
@inject NavigationManager navigationManager
@page "/salidas/rescate/{TipoRescate:int}/{AnioSalida:int}/{NumeroSalida:int}"

@using Vista.Data.ViewModels.Personal;
@using Vista.Data.ViewModels.Rescates;
@using Vista.Data.Enums.Salidas;

@*Servicios Utilizados*@
@using Vista.Services;
@inject ISalidaService SalidaService
@inject IBomberoService BomberoService
@inject IVehiculoSalidaService VehiculoSalidaService
@inject INavigationInterception NavigationInterception
@inject IFuerzaIntervinienteService FuerzaIntervinienteService

@*Componentes Generales*@
@using Vista.Components.Forms.Salidas.General;
@using Vista.Components.Forms.Salidas;

<Form Model="@PersonaViewModel"
      LabelColSpan="8"
      WrapperColSpan="16"
      OnFinish="OnFinish"
      OnFinishFailed="OnFinishFailed"
      Style="width: 100%; height: 100%; overflow: auto;">

    <div style="max-width: 1800px; margin: 0 auto; padding: 2rem 1rem;">

        <!-- Header -->
        <div style="text-align: center; margin-bottom: 3rem; padding-bottom: 1rem; border-bottom: 2px solid #f0f0f0;">
            @if (TipoRescate == 1)
            {
                <h1 style="margin: 0; color: #1890ff; font-size: 2.5rem; font-weight: 600;">
                    RESCATE PERSONA
                </h1>
            }
            else if (TipoRescate == 2)
            {
                <h1 style="margin: 0; color: #1890ff; font-size: 2.5rem; font-weight: 600;">
                    RESCATE ANIMAL
                </h1>
            }

            <p style="margin: 0.5rem 0 0 0; color: #666; font-size: 1.1rem;">
                Complete todos los campos requeridos para registrar la salida
            </p>
        </div>

        <!-- Tabs container -->
        <Tabs DefaultActiveKey="1" Class="custom-tabs" Style="box-shadow: 0 4px 16px rgba(24,144,255,0.08); border-radius: 12px;">
            <TabPane Key="1" Tab="📋 Datos-Generales" Class="tab-general">
                <DatosGenerales Model="@PersonaViewModel" OnCompleted="@((bool done) => _parte1Completa = done)" />
            </TabPane>

            <TabPane Key="2" Tab="📞 Datos Telefónicos">
                <Participantes Model="@PersonaViewModel" 
                               OnCompleted="@((bool done) => _parte2Completa = done)" />
            </TabPane>

            <TabPane Key="3" Tab="🛡️ Fuerzas Intervinientes">
                <FuerzasIntervinientes Model="@PersonaViewModel" />
            </TabPane>

            <TabPane Key="4" Tab="👤 Damnificados">
                <Damnificados Model="@PersonaViewModel" />
            </TabPane>

            <TabPane Key="5" Tab="🚒 Unidades">
                <Vehiculos Model="@PersonaViewModel" BomberosTodos="@BomberosTodos" Flota="@MovilesTodos" />
            </TabPane>

            <TabPane Key="6" Tab="🪪 Personal">
                <Personal Model="@PersonaViewModel" BomberosTodos="@BomberosTodos" />
            </TabPane>

            <TabPane Key="7" Tab="🛠️ Tipo de Servicio">
                <TipoDeServicio Model="@PersonaViewModel" isUnlocked="true" OnCompleted="@((bool done) => {/* noop */})" />
                <div class="submit-section-firmas">
                    <FormItem WrapperColSpan="24" Style="margin: 0;">
                        <Button HtmlType="submit"
                                Size="ButtonSize.Large"
                                class="submit-button-firmas">
                            <Icon Type="printer" Style="margin-right: 0.5rem;" />
                            Imprimir Salida
                        </Button>
                    </FormItem>
                </div>
            </TabPane>

        </Tabs>

        @if (_visible1 == true)
        {
            <ImprimirModal AnioNumeroParte="@ImprimirAnio" NumeroParte="@ImprimirNumeroParte" />
        }
    </div>
</Form>

<style>


    .custom-tabs .ant-tabs-nav {
    border-bottom: none !important;
    margin-bottom: 1.5rem !important;
    display: flex;
    justify-content: center;
    }
    
    
    .custom-tabs .ant-tabs-tab {
    background: #f9f9f9;
    border-radius: 8px 8px 0 0;
    margin: 0 0.25rem;
    padding: 0.5rem 1.25rem;
    font-weight: 600;
    color: #555;
    transition: all 0.25s ease;
}


.custom-tabs .ant-tabs-tab:hover {
    background: #e6f7ff;
    color: #1890ff;
    cursor: pointer;
}

.custom-tabs .ant-tabs-tab-active {
    background: white;
    color: #1890ff !important;
    box-shadow: 0 -2px 8px rgba(0,0,0,0.08);
    border: 1px solid #e6f7ff;
    border-bottom: none;
    z-index: 1;
    position: relative;
}

.custom-tabs .ant-tabs-tab-active .ant-tabs-tab-btn {
    font-weight: 700;
}

    /* Estilos para secciones deshabilitadas/inhabilitadas */
    .section-card.disabled {
        background: #f5f5f5 !important;
        border-left-color: #d9d9d9 !important;
        opacity: 0.6;
        pointer-events: none;
        position: relative;
        overflow: hidden;
    }

        .section-card.disabled:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08) !important;
            transform: none !important;
        }

        /* Overlay para indicar que está deshabilitada */
        .section-card.disabled::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.7);
            z-index: 1;
            pointer-events: none;
        }

        /* Icono de candado para secciones deshabilitadas */
        .section-card.disabled::after {
            content: '🔒';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            z-index: 2;
            opacity: 0.5;
            pointer-events: none;
        }

        /* Título de sección deshabilitada */
        .section-card.disabled .section-title {
            color: #999 !important;
        }

        .section-card.disabled .section-number {
            background: #d9d9d9 !important;
            color: #999 !important;
        }

        /* Contenido dentro de sección deshabilitada */
        .section-card.disabled * {
            color: #999 !important;
        }

        .section-card.disabled .form-group-card {
            background: #f0f0f0 !important;
            border-color: #e8e8e8 !important;
        }

        .section-card.disabled .form-label {
            color: #bbb !important;
        }

        /* Inputs deshabilitados específicamente para Ant Design */
        .section-card.disabled .ant-select,
        .section-card.disabled .ant-input,
        .section-card.disabled .ant-btn,
        .section-card.disabled .ant-checkbox,
        .section-card.disabled .ant-radio {
            pointer-events: none !important;
            opacity: 0.6 !important;
            background-color: #f5f5f5 !important;
            color: #999 !important;
        }

        .section-card.disabled .ant-select-selector {
            background-color: #f5f5f5 !important;
            color: #999 !important;
        }

    /* Variante alternativa sin overlay (más sutil) */
    .section-card.disabled-subtle {
        background: #fafafa !important;
        border-left-color: #e8e8e8 !important;
        opacity: 0.8;
        pointer-events: none;
        filter: grayscale(0.5);
    }

        .section-card.disabled-subtle:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08) !important;
            transform: none !important;
        }

        .section-card.disabled-subtle .section-title {
            color: #bbb !important;
        }

        .section-card.disabled-subtle .section-number {
            background: #e8e8e8 !important;
            color: #999 !important;
        }

    /* Mensaje de ayuda para secciones deshabilitadas */
    .disabled-message {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        font-size: 0.875rem;
        z-index: 3;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .section-card.disabled:hover .disabled-message {
        opacity: 1;
    }

    /* Animación para cuando se habilita una sección */
    .section-card.enabling {
        animation: enableSection 0.5s ease-out;
    }

    @@keyframes enableSection {
        0% {
            opacity: 0.6;
            filter: grayscale(0.5);
            transform: scale(0.98);
        }

        100% {
            opacity: 1;
            filter: grayscale(0);
            transform: scale(1);
        }
    }

    /* Para móviles - ajustar el icono de candado */
    @@media (max-width: 767px) {
        .section-card.disabled::after {
            font-size: 2rem;
        }

        .disabled-message {
            right: 0.5rem;
            top: 0.5rem;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
    }
    /* Grid principal */
    .main-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }


    .two-column-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }


    .section-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        padding: 2rem;
        transition: all 0.3s ease;
    }

        .section-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }



    .tipo-servicio {
        border-left: 4px solid #eb2f96;
    }


    .section-title {
        margin: 0 0 1.5rem 0;
        font-size: 1.4rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }


    .section-number {
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: bold;
    }

    /* Grid para tipos de servicio */
    .service-type-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
    }

    .form-group-card {
        background: #fafafa;
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid #e8e8e8;
    }

    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #333;
    }


    .submit-section-firmas {
        background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
        border-radius: 12px;
        padding: 2rem;
        text-align: center;
        margin-top: 1rem;
    }

    .submit-button-firmas {
        background: white !important;
        color: #1890ff !important;
        border: none !important;
        font-weight: 600 !important;
        padding: 0.75rem 3rem !important;
        height: auto !important;
        font-size: 1.1rem !important;
        border-radius: 8px !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        transition: all 0.3s ease !important;
    }

    .submit-button-firmas:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 8px 20px rgba(0,0,0,0.2) !important;
    }




    @@media (max-width: 1599px) and (min-width: 1200px) {
        .main-grid {
            max-width: 1400px;
        }
    }


    @@media (max-width: 1199px) {
        .two-column-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .service-type-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .section-card {
            padding: 1.5rem;
        }
    }

    @@media (max-width: 991px) {
        .main-grid {
            padding: 1rem 0.5rem;
        }

        h1 {
            font-size: 2rem !important;
        }

        .section-title {
            font-size: 1.3rem !important;
        }
    }


    @@media (max-width: 767px) {
        .main-grid {
            padding: 1rem 0.5rem;
            gap: 1.5rem;
        }

        .section-card {
            padding: 1rem !important;
        }

        h1 {
            font-size: 1.8rem !important;
        }

        .section-title {
            font-size: 1.2rem !important;
        }

        .submit-section-firmas {
            padding: 1.5rem !important;
        }

        .submit-button-firmas {
            padding: 0.6rem 2rem !important;
            font-size: 1rem !important;
        }
    }


    @@media (max-width: 480px) {
        .main-grid {
            padding: 0.5rem 0.25rem;
        }

        .section-card {
            padding: 0.75rem !important;
        }

        .form-group-card {
            padding: 1rem !important;
        }

        h1 {
            font-size: 1.6rem !important;
        }

        .section-title {
            font-size: 1.1rem !important;
        }
    }


    @@media (min-width: 1600px) {
        .main-grid {
            gap: 2.5rem;
        }

        .two-column-grid {
            gap: 2.5rem;
        }

        .section-card {
            padding: 2.5rem;
        }
    }

    @@media (min-width: 1800px) {
        .service-type-grid {
            grid-template-columns: 1fr 1fr 1fr;
        }
        .ultra-wide-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
        }
    }
</style>