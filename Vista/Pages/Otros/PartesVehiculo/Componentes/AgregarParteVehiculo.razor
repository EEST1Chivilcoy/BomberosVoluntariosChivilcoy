@using Vista.Data.Enums.Discriminadores;
@using Vista.Data.Models.Otros.Partes;

@*Servicios Utilizados*@
@using Vista.Services
@inject IMessageService message
@inject IParteVehiculoService ParteVehiculoService

<style>
    /* Estilo para los campos */
    .ant-form-item {
        margin-bottom: 16px !important;
    }

    .ant-form-item-label > label {
        color: #595959 !important;
        font-weight: 500 !important;
    }

    .ant-input,
    .ant-select:not(.ant-select-customize-input) .ant-select-selector,
    .ant-picker,
    .ant-input-number {
        border-radius: 4px !important;
        border: 1px solid #d9d9d9 !important;
    }

        .ant-input:hover,
        .ant-select:not(.ant-select-customize-input) .ant-select-selector:hover,
        .ant-picker:hover,
        .ant-input-number:hover {
            border-color: #c43a3a !important;
        }

        .ant-input:focus,
        .ant-select-focused:not(.ant-select-customize-input) .ant-select-selector,
        .ant-picker-focused,
        .ant-input-number-focused {
            border-color: #c43a3a !important;
            box-shadow: 0 0 0 2px rgba(196, 58, 58, 0.2) !important;
        }

    /* Ajuste visual para el switch */
    .ant-switch-checked {
        background-color: #c43a3a !important;
    }

    /* Estilo para campos requeridos */
    .required-field::after {
        content: '*' !important;
        color: #c43a3a !important;
        margin-left: 4px !important;
    }

    /* Estilo para el campo condicional de chofer */
    .conditional-field {
        margin-top: 12px !important;
        padding-top: 12px !important;
        border-top: 1px dashed #f0f0f0 !important;
    }
</style>

<Form Model="@agregarParteVehiculoViewModel"
      Loading="_isLoading">
    <FormItem Label="Nombre"
              Class="required-field">
        <Input @bind-Value="@agregarParteVehiculoViewModel.Nombre"
               Placeholder="Ingrese el nombre de la parte del vehículo" AllowClear />
    </FormItem>
    <FormItem Label="Tipo de Parte"
              Class="required-field">
        <EnumSelect TEnum="TipoParteVehiculo ?" @bind-Value="@agregarParteVehiculoViewModel.TipoParte" AllowClear />
    </FormItem>
</Form>



@code {
    [Parameter] public required EventCallback OnCancel { get; set; }

    private AgregarParteVehiculoViewModel agregarParteVehiculoViewModel = new();
    private bool _isLoading = false;

    public class AgregarParteVehiculoViewModel
    {
        public string? Nombre { get; set; }
        public TipoParteVehiculo? TipoParte { get; set; }
    }

    public async Task CancelarAsync()
    {
        if (OnCancel.HasDelegate)
        {
            await OnCancel.InvokeAsync(null);
        }
    }

    private async Task OnFinish(EditContext editContext)
    {
        _isLoading = true;

        try
        {
            // Preparamos el modelo para enviar al servicio
            var nuevaParteVehiculo = new ParteVehiculo
            {
                Nombre = agregarParteVehiculoViewModel.Nombre!,
                Tipo = agregarParteVehiculoViewModel.TipoParte!.Value
            };
        }
        catch (Exception ex)
        {
            message.Error($"Error: {ex.Message}");
        }
        finally
        {
            _isLoading = false;
        }
    }
}